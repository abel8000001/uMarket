<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
 xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
 x:Class="uMarket.Pages.SellerMainPage"
 Title="Panel del Vendedor">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">
            <!-- Header -->
            <Grid ColumnDefinitions="*,Auto">
                <Label Grid.Column="0"
                       Text="Panel del Vendedor" 
                       FontAttributes="Bold" 
                       FontSize="22" 
                       VerticalOptions="Center"
                       TextColor="{StaticResource Primary}" />
                <Button Grid.Column="1"
                        Text="Cerrar Sesión" 
                        Clicked="LogoutButton_Clicked" 
                        BackgroundColor="#FF3B30" 
                        TextColor="White"
                        FontSize="14"
                        Padding="12,6"
                        CornerRadius="6"/>
            </Grid>

            <!-- Profile Section -->
            <Frame Padding="16" CornerRadius="8" HasShadow="True">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Tu Perfil" FontAttributes="Bold" FontSize="18" />
                    <BoxView HeightRequest="1" Color="LightGray" />
                    
                    <HorizontalStackLayout Spacing="12">
                        <VerticalStackLayout HorizontalOptions="FillAndExpand" Spacing="4">
                            <Label Text="Disponible para chats" FontSize="16" FontAttributes="Bold" />
                            <Label x:Name="AvailabilityStatusLabel" 
                                   Text="Actualmente No Disponible" 
                                   FontSize="14" 
                                   TextColor="Gray" />
                        </VerticalStackLayout>
                        <Switch x:Name="AvailableSwitch" 
                                Toggled="AvailableSwitch_Toggled" 
                                VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <Label Text="¿Qué estás vendiendo hoy?" FontSize="14" FontAttributes="Bold" Margin="0,8,0,0" />
                    <Frame Padding="8" CornerRadius="6" BorderColor="LightGray">
                        <Editor x:Name="DescriptionEditor" 
                                HeightRequest="100" 
                                Placeholder="Ej: Vendiendo libros, comida, manualidades..." />
                    </Frame>

                    <Button x:Name="SaveButton" 
                            Text="Guardar Descripción" 
                            Clicked="SaveButton_Clicked" 
                            BackgroundColor="{StaticResource Primary}" 
                            TextColor="White" />
                </VerticalStackLayout>
            </Frame>

            <!-- Pending Requests Section -->
            <Frame Padding="12" CornerRadius="8" HasShadow="True">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Solicitudes de Chat Pendientes" FontAttributes="Bold" FontSize="18" />
                    <BoxView HeightRequest="1" Color="LightGray" />
                    
                    <CollectionView x:Name="RequestsCollection" 
                                    SelectionMode="None"
                                    EmptyView="No hay solicitudes pendientes">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame Padding="12" Margin="0,4" CornerRadius="8" BackgroundColor="#FFF3E0">
                                    <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8" RowSpacing="8">
                                        <VerticalStackLayout Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3">
                                            <Label Text="{Binding FromFullName}" FontAttributes="Bold" FontSize="16" />
                                            <Label Text="{Binding CreatedAt, StringFormat='Solicitado: {0:g}'}" FontSize="12" TextColor="Gray" />
                                        </VerticalStackLayout>
                                        <Button Grid.Row="1" Grid.Column="1" 
                                                Text="Aceptar" 
                                                Clicked="AcceptButton_Clicked" 
                                                BackgroundColor="#4CAF50" 
                                                TextColor="White"
                                                FontSize="12" />
                                        <Button Grid.Row="1" Grid.Column="2" 
                                                Text="Rechazar" 
                                                Clicked="DenyButton_Clicked" 
                                                BackgroundColor="#F44336" 
                                                TextColor="White"
                                                FontSize="12" />
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Active Chats Section -->
            <Frame Padding="12" CornerRadius="8" HasShadow="True">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Chats Activos" FontAttributes="Bold" FontSize="18" />
                    <BoxView HeightRequest="1" Color="LightGray" />
                    
                    <CollectionView x:Name="ConversationsCollection" 
                                    SelectionMode="None"
                                    EmptyView="No tienes conversaciones activas">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="12" Margin="0,4">
                                    <Frame Padding="12" CornerRadius="8" BackgroundColor="#F8F9FA" HasShadow="False">
                                        <Frame.GestureRecognizers>
                                            <TapGestureRecognizer Tapped="ConversationFrame_Tapped" />
                                        </Frame.GestureRecognizers>
                                        <Grid ColumnDefinitions="*,Auto">
                                            <VerticalStackLayout Grid.Column="0" Spacing="4">
                                                <Label Text="{Binding OtherFullName}" 
                                                       FontSize="16" 
                                                       FontAttributes="Bold" 
                                                       TextColor="#212529" />
                                                <Label Text="{Binding LastMessageAt, StringFormat='Último mensaje: {0:g}'}" 
                                                       FontSize="12" 
                                                       TextColor="Gray" />
                                            </VerticalStackLayout>
                                            <Label Grid.Column="1" 
                                                   Text="›" 
                                                   FontSize="24" 
                                                   TextColor="{StaticResource Primary}" 
                                                   VerticalOptions="Center" />
                                        </Grid>
                                    </Frame>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>